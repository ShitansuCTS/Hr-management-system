generator client {
  provider = "prisma-client-js"
  output   = "../src/lib/generated/prisma"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

///////////////////////////
// ENUMS
///////////////////////////

enum Role {
  ADMIN
  EMPLOYEE
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERN
}

enum HolidayType {
  NATIONAL
  FESTIVAL
  COMPANY
}

enum LeaveType {
  PAID_LEAVE           
  SICK_LEAVE           
  CASUAL_LEAVE         
  MATERNITY_LEAVE      
  PATERNITY_LEAVE    
  BEREAVEMENT_LEAVE    
  OPTIONAL_LEAVE       
}
enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

///////////////////////////
// ORGANIZATION
///////////////////////////
model Organization {
  id        String   @id @default(uuid())
  name      String
  domain    String?   // optional, e.g., company email domain
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users     User[]   // 1:N relation to Users
  holidays  Holiday[]  
}

///////////////////////////
// USER
///////////////////////////
model User {
  id            String      @id @default(uuid())

  // =========================
  // Login & Auth
  // =========================
  email         String      @unique
  password      String
  role          Role
  status        UserStatus  @default(ACTIVE)
  lastLoginAt   DateTime?

  // =========================
  // Employee Core Details
  // =========================
  employeeId    String          // given by HR
  fullName      String
  phone         String
  designation   String
  department    String?
  employmentType EmploymentType?
  workLocation  String?
  dateOfJoining DateTime

  // =========================
  // Personal Details
  // =========================
  profileImageUrl String?
  gender          Gender?
  dateOfBirth     DateTime?
  fatherName      String?
  motherName      String?

  // =========================
  // Address Details
  // =========================
  currentAddress    String?
  permanentAddress  String?
  city              String?
  state             String?
  country           String?
  pincode           String?

  // =========================
  // Emergency Contact
  // =========================
  emergencyContactName     String?
  emergencyContactPhone    String?
  emergencyContactRelation String?

  // =========================
  // Reporting Manager (Simple)
  // =========================
  reportingManagerName String?

  // =========================
  // Organization Relation
  // =========================
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId String

  // =========================
  // Leave Balance
  // =========================
  leaveBalances LeaveBalance[]
  LeaveApplication LeaveApplication[]

  // =========================
  // System & Safety
  // =========================
  isDeleted     Boolean   @default(false)
  deletedAt     DateTime?

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@unique([employeeId, organizationId])
}

///////////////////////////
// HOLIDAY
///////////////////////////
model Holiday {
  id          String        @id @default(uuid())

  name        String        // Ganesh Puja
  date        DateTime      // 2026-09-19
  day         String        // Friday (store for fast UI)
  year        Int           // 2026

  type        HolidayType
  description String?

  // Optional: if later multiple orgs
  organization   Organization? @relation(fields: [organizationId], references: [id])
  organizationId String?

  isDeleted   Boolean       @default(false)

  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  @@unique([date, organizationId])
}

///////////////////////////
// LEAVE BALANCE
///////////////////////////
model LeaveBalance {
  id        String @id @default(uuid())

  user      User   @relation(fields: [userId], references: [id])
  userId    String

  leaveType LeaveType   
  total     Int      

  createdAt DateTime @default(now())

  @@unique([userId, leaveType])
}


///////////////////////////
// LEAVE APPLICTAIONS
///////////////////////////
model LeaveApplication {
  id         String     @id @default(uuid())
  user       User       @relation(fields: [userId], references: [id])
  userId     String

  leaveType  LeaveType
  startDate  DateTime
  endDate    DateTime
  reason     String
  status LeaveStatus @default(PENDING)


  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
}

